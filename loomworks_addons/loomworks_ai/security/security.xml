<?xml version="1.0" encoding="utf-8"?>
<!--
    Part of Loomworks ERP. See LICENSE file for full copyright and licensing details.
    License: LGPL-3
-->
<loomworks>

    <!-- AI Manager Group -->
    <record id="group_ai_user" model="res.groups">
        <field name="name">AI User</field>
        <field name="category_id" ref="base.module_category_productivity"/>
        <field name="comment">Can use AI chat features</field>
    </record>

    <record id="group_ai_manager" model="res.groups">
        <field name="name">AI Manager</field>
        <field name="category_id" ref="base.module_category_productivity"/>
        <field name="implied_ids" eval="[(4, ref('group_ai_user'))]"/>
        <field name="comment">Can configure AI agents and view all sessions</field>
    </record>

    <!-- AI Agent Access: Company Isolation -->
    <record id="ai_agent_rule_company" model="ir.rule">
        <field name="name">AI Agent: Company Isolation</field>
        <field name="model_id" ref="model_loomworks_ai_agent"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
    </record>

    <!-- Sessions: Users see only their own -->
    <record id="ai_session_rule_own" model="ir.rule">
        <field name="name">AI Session: Own Sessions Only</field>
        <field name="model_id" ref="model_loomworks_ai_session"/>
        <field name="domain_force">[('user_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('group_ai_user'))]"/>
    </record>

    <!-- Managers can see all sessions in their company -->
    <record id="ai_session_rule_manager" model="ir.rule">
        <field name="name">AI Session: Manager Access</field>
        <field name="model_id" ref="model_loomworks_ai_session"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        <field name="groups" eval="[(4, ref('group_ai_manager'))]"/>
    </record>

    <!-- Messages: Users see only their session's messages -->
    <record id="ai_message_rule_own" model="ir.rule">
        <field name="name">AI Message: Own Sessions Only</field>
        <field name="model_id" ref="model_loomworks_ai_message"/>
        <field name="domain_force">[('session_id.user_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('group_ai_user'))]"/>
    </record>

    <!-- Managers can see all messages in their company -->
    <record id="ai_message_rule_manager" model="ir.rule">
        <field name="name">AI Message: Manager Access</field>
        <field name="model_id" ref="model_loomworks_ai_message"/>
        <field name="domain_force">[('session_id.company_id', 'in', company_ids)]</field>
        <field name="groups" eval="[(4, ref('group_ai_manager'))]"/>
    </record>

    <!-- Operation Logs: Users see only their own -->
    <record id="ai_operation_log_rule_own" model="ir.rule">
        <field name="name">AI Operation Log: Own Only</field>
        <field name="model_id" ref="model_loomworks_ai_operation_log"/>
        <field name="domain_force">[('user_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('group_ai_user'))]"/>
    </record>

    <!-- Managers can see all operation logs in their company -->
    <record id="ai_operation_log_rule_manager" model="ir.rule">
        <field name="name">AI Operation Log: Manager Access</field>
        <field name="model_id" ref="model_loomworks_ai_operation_log"/>
        <field name="domain_force">[('session_id.company_id', 'in', company_ids)]</field>
        <field name="groups" eval="[(4, ref('group_ai_manager'))]"/>
    </record>

    <!-- User Settings: Users see only their own -->
    <record id="ai_user_settings_rule_own" model="ir.rule">
        <field name="name">AI User Settings: Own Only</field>
        <field name="model_id" ref="model_loomworks_ai_user_settings"/>
        <field name="domain_force">[('user_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('group_ai_user'))]"/>
    </record>

    <!-- Managers can see all user settings in their company -->
    <record id="ai_user_settings_rule_manager" model="ir.rule">
        <field name="name">AI User Settings: Manager Access</field>
        <field name="model_id" ref="model_loomworks_ai_user_settings"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        <field name="groups" eval="[(4, ref('group_ai_manager'))]"/>
    </record>

</loomworks>
