<?xml version="1.0" encoding="utf-8"?>
<loomworks>
    <!-- PLM Security Groups -->

    <record id="module_category_plm" model="ir.module.category">
        <field name="name">PLM</field>
        <field name="description">Product Lifecycle Management</field>
        <field name="sequence">20</field>
    </record>

    <record id="group_plm_user" model="res.groups">
        <field name="name">PLM User</field>
        <field name="category_id" ref="module_category_plm"/>
        <field name="implied_ids" eval="[(4, ref('mrp.group_mrp_user'))]"/>
        <field name="comment">Can view and create ECOs, view BOM revisions</field>
    </record>

    <record id="group_plm_manager" model="res.groups">
        <field name="name">PLM Manager</field>
        <field name="category_id" ref="module_category_plm"/>
        <field name="implied_ids" eval="[(4, ref('group_plm_user'))]"/>
        <field name="comment">Can manage ECO types, stages, and approve ECOs</field>
    </record>

    <!-- Record Rules -->

    <record id="plm_eco_rule_user" model="ir.rule">
        <field name="name">PLM ECO: User can see own company ECOs</field>
        <field name="model_id" ref="model_plm_eco"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        <field name="groups" eval="[(4, ref('group_plm_user'))]"/>
    </record>

    <record id="plm_eco_approval_rule" model="ir.rule">
        <field name="name">PLM Approval: Users see their approvals or managed ECOs</field>
        <field name="model_id" ref="model_plm_eco_approval"/>
        <field name="domain_force">['|', ('user_id', '=', user.id), ('eco_id.responsible_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('group_plm_user'))]"/>
    </record>

    <record id="plm_eco_approval_rule_manager" model="ir.rule">
        <field name="name">PLM Approval: Managers see all</field>
        <field name="model_id" ref="model_plm_eco_approval"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_plm_manager'))]"/>
    </record>

</loomworks>
